function commas(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}var Filer=Backbone.Model.extend({}),Meta=Backbone.Model.extend({initialize:function(){this.convert_for_display("total_contributions"),this.convert_for_display("total_expenditures"),this.convert_for_display("cash_on_hand"),this.convert_for_display("outstanding_loans")},convert_for_display:function(t){this.set(t,commas(parseFloat(this.get(t)).toFixed(0)))}}),Measurement=Backbone.Model.extend({initialize:function(){this.set("amt",commas(parseFloat(this.get("amt")).toFixed(0)))}}),ContributionByState=Measurement.extend({}),ContributionByDate=Measurement.extend({}),ContributionByZip=Measurement.extend({}),TopDonor=Measurement.extend({}),Bucket=Backbone.Model.extend({formalBucketNames:{less_5k:"Less than $5,000","5k_10k":"$5,000 to $10,000","10k_20k":"$10,000 to $20,000","20k_50k":"$20,000 to $50,000","50k_100k":"$50,000 to $100,000",more_100k:"More than $100,000"},initialize:function(){this.set("amt_display",commas(parseFloat(this.get("amt")).toFixed(0))),this.set("name_display",this.formalBucketNames[this.get("name")]),this.set("percent_of_total",this.get_percent_of_total())},get_percent_of_total:function(){return(parseFloat(this.get("amt"))/parseFloat(this.get("total_contributions"))*100).toFixed(1)}}),ActiveFiler=Backbone.Model.extend({urlRoot:"//tx-tecreports.herokuapp.com/api/v1/report/",url:function(){var t=_.result(this,"urlRoot");return t+encodeURIComponent(this.id)+"/?callback=?"},parse:function(t){return _.each(t.buckets,function(e){e.total_contributions=t._meta.total_contributions}),t._meta=new Meta(t._meta),t.contribs_by_state=new StateContributions(t.contribs_by_state),t.contribs_by_date=new DateContributions(t.contribs_by_date),t.top_ten_donations=new TopDonors(t.top_ten_donations),t.buckets=new Buckets(t.buckets),t},fetchFiler:function(t){this.set({id:t},{silent:!0}),this.fetch()}}),activeFiler=new ActiveFiler,Filers=Backbone.Collection.extend({model:Filer,url:"data/filers.json",comparator:"filer_name"}),filers=new Filers,StateContributions=Backbone.Collection.extend({model:ContributionByState,comparator:"-amt"}),DateContributions=Backbone.Collection.extend({model:ContributionByDate}),ZipContributions=Backbone.Collection.extend({model:ContributionByZip,comparator:"-amt"}),TopDonors=Backbone.Collection.extend({model:TopDonor,comparator:"-amt"}),Buckets=Backbone.Collection.extend({model:Bucket}),FilerOptionView=Backbone.View.extend({tagName:"div",template:_.template('<option value="<%= report_id %>"><%= display_name %> (<%= party %>) - <%= race %> <%= type %></option>'),render:function(){return this.$el.html(this.template(this.model.toJSON())),this}}),FilerSelectView=Backbone.View.extend({el:"#filer-select-view",events:{change:"triggerLoad"},initialize:function(t){this.activeFiler=t.activeFiler,this.listenTo(this.collection,"reset",this.render)},render:function(){var t=[];this.collection.each(function(e){var i=new FilerOptionView({model:e});t.push(i.render().el.childNodes[0])}),this.$el.append(t)},triggerLoad:function(){var t=this.$el.val();this.activeFiler.fetchFiler(t)}}),MetaView=Backbone.View.extend({el:"#meta-view",template:_.template($("#meta-view-template").html()),initialize:function(){this.listenTo(this.model,"change:_meta",this.render)},render:function(){return this.$el.html(this.template(this.model.get("_meta").toJSON())),this}}),StateContributionsView=Backbone.View.extend({el:"#state-contributions-view",template:_.template($("#state-contributions-view-template").html()),initialize:function(){this.listenTo(this.model,"change:contribs_by_state",this.render)},render:function(){var t=this,e="";this.model.get("contribs_by_state").each(function(i){e+=t.template(i.toJSON())}),this.$el.html(e)}}),ZipContributionsView=Backbone.View.extend({el:"#zip-contributions-view",template:_.template($("#zip-contributions-view-template").html()),initialize:function(){this.listenTo(this.model,"change:top_contribs_by_zip",this.render)},render:function(){var t=this,e="";this.model.get("top_contribs_by_zip").each(function(i){e+=t.template(i.toJSON())}),this.$el.html(e)}}),DateContributionsView=Backbone.View.extend({el:"#date-contributions-view",template:_.template($("#date-contributions-view-template").html()),initialize:function(){this.listenTo(this.model,"change:contribs_by_date",this.render)},render:function(){var t=this,e="";this.model.get("contribs_by_date").each(function(i){e+=t.template(i.toJSON())}),this.$el.html(e)}}),TopDonorsView=Backbone.View.extend({el:"#top-donors-view",template:_.template($("#top-donors-view-template").html()),initialize:function(){this.listenTo(this.model,"change:top_ten_donations",this.render)},render:function(){var t=this,e="";this.model.get("top_ten_donations").each(function(i){e+=t.template(i.toJSON())}),this.$el.html(e)}}),BucketsView=Backbone.View.extend({el:"#bucket-contributions-view",template:_.template($("#contrib-buckets-view-template").html()),initialize:function(){this.listenTo(this.model,"change:buckets",this.render)},render:function(){var t=this,e="";this.model.get("buckets").each(function(i){e+=t.template(i.toJSON())}),this.$el.html(e)}});new FilerSelectView({collection:filers,activeFiler:activeFiler}),new MetaView({model:activeFiler}),new StateContributionsView({model:activeFiler}),new DateContributionsView({model:activeFiler}),new TopDonorsView({model:activeFiler}),new BucketsView({model:activeFiler}),filers.fetch({reset:!0});